---
title: Метадинамика
date: 2021-05
bibliography: ../../assets/citation.legacy.yaml
categories:
    - molecular dynamics
    - russian
---

## Коллективные переменные

Фазовое пространство молекулярно-динамической траектории сложно анализировать непосредственно, но из него можно выделить некоторое полезное подмножество координат, после чего сконструировать из них *коллективные переменные* $\mathbf{S}=(S_1,\cdots,S_d)$, позволяющие формулировать состоятельные утверждения о внутренних степенях свободы системы (например, белковой молекулы).

Некоторые простые КП и их интерпретация[^footnote:CV-notation]:

1.  расстояние между двумя атомами^[здесь и далее --- не между произвольными атомами, а между наперёд заданными; $\mathbf{r}_i$ --- радиус-вектор $i$го атома, $\mathbf{r}_{i,j}$ --- вектор c началом в $i$м и конце в $j$м атомах] (или между центрами масс групп атомов) $S=|\mathbf{r}_i-\mathbf{r}_j|$ --- собственно расстояние или длина связи;

2.  угол между тремя атомами $S=\widehat{\mathbf{r}_i,\mathbf{r}_j,\mathbf{r}_k}$ --- валентный угол;

3.  двугранный угол, образованный четырьмя атомами, $S=\widehat{\mathbf{r}_{i,j},\mathbf{r}_{k,l}}$ --- торсионный угол;

4.  количество соседей внутри шара радиуса $R$, описанного вокруг атома, $S=\mathrm{card} \left\{ \mathbf{r}_i : |\mathbf{r}_i-\mathbf{r}_j| \leq R \right\} - 1$ --- координационное число, оператор $\mathrm{card}$ обозначает размер множества (англ. cardinality).

## Метадинамика
Численный эксперимент МД ограничен доступным машинным временем, в нормальном случае его не хватит для исследования всего ФП, а если энергические барьеры между состояниями достаточно высоки, за время моделирования система может даже не покинуть начальную область ФП, пример системы, в которой может наблюдаться такая картина, приведён на @fig-reaction-profile; подобный маловероятный «прыжок» молекулы из одного минимума в другой называют *редким событием* [@Glowacki2009].

![Профиль свободной энергии @atta-fynn](reaction-profile){#fig-reaction-profile width=70%}

Метадинамика --- неравновесный метод молекулярного моделирования. Для эффективного получения выборки из ФП к потенциалам взаимодействия, описанным в [Описание метода], добавляют зависящий от КП^[обозначения коллективных переменных были введены в [Коллективные переменные]] $\mathbf{S(q)}$ и времени $t$ смещающий потенциал $V(\mathbf{S(q)},t)$, который будет способствовать выходу системы из её энергетического минимума, что, в свою очередь, позволит исследовать новые области ФП.

Для пространства $\mathbf{S(q)}$ изменение потенциала
$V(\mathbf{S(q)},t)$ во времени происходит не непрерывно; в начале симуляции $V(\mathbf{S(q)},t=0)=0$, однако через равные промежутки времени $\tau$ к нему добавляются гауссовы функции так, чтобы положение их максимумов совпало с текущем значением коллективных переменных $\mathbf{s}(t)$:

$$V(t)=V(t-\tau)+h(t)\exp\left\{ -\dfrac{1}{2}\sum_{i=1}^{d}\left(\dfrac{s_{i}(t)-s_{i}(\lfloor t/\tau\rfloor\cdot\tau)}{\sigma_{i}}\right)^{2}\right\}$$
или, если исключить предыдущее значение $V(t-\tau)$ и суммировать по шагам $k$ явно,

$$V(\bf s,t)=\sum_{k=1}^{\lfloor t/\tau\rfloor}h(t)\exp\left\{ -\dfrac 1 2 \sum_{i=1}^d \left(\dfrac{s_i-s_i(k \tau)}{\sigma_i}\right)^2\right\} .$$ {#eq-metaMD-eq}

![Этапы наложения гауссиан в процессе метадинамики: *а*) начало симуляции; *б*) выход из области начального состояния; *в*) исследование области конечного состояния; *г*) свободное плавание](meta-dynamics){#fig-meta-dynamics}

Накачку системы энергией называют *нагреванием*, поскольку в процессе температура неизбежно возрастёт на *фиктивную* величину $\Delta T$; если в начальный момент система условно находилась в нуле энергии, то в ходе нагрева ей становятся доступны состояния со свободной энергией
$[0\,..\,k\Delta T]$ за вполне обозримое время.

Высоту экспоненты в @eq-metaMD-eq задаёт $h(t)$, в классической метадинамике её
принимают постоянной и равной $h_{0}$. В большом временном пределе
$F(\mathbf{s})+V(\mathbf{s},t)$ обращается в константу, поэтому оценка свободной энергии
$$F(\mathbf{s})=\mathrm{const}-\lim_{t\to\infty}V(\mathbf{s},t),$$ {#eq-standard-metad-free-energy}
т.е. зная, как смещающий потенциал $V(\mathbf{S},t)$ меняется во времени, можно реконструировать вид поверхности потенциальной энергии [@Barducci2008; @Barducci2011].

## *Well-tempered* метадинамика

Для лучшей сходимости метадинамики, высота $h(t)$ на больших временных масштабах должна уменьшаться, например, по закону: 
$$
\begin{aligned}
h(t) & = & h_{0}\exp\left\{ -\dfrac{V(\mathbf{s}(t),t)}{k\Delta T}\right\} ,
\end{aligned}
$$
эту модификацию называют *well-tempered* метадинамикой, высота гауссианы определяется привнесённым смещением $V(\mathbf{s}(t),t)$ и фиктивной температурой $\Delta T$. Если система перешла в новую область ФП, где ещё не был наложен смещающий потенциал, высота добавляемых гауссиан вновь вырастет до значения $h_{0}$ и будет уменьшаться с ростом
$V(\mathbf{s}(t),t)$ в этой области. Аналогично @eq-standard-metad-free-energy можно записать оценку
$$
F(\mathbf{s})=\mathrm{const}-\left(1+\dfrac{T}{\Delta T}\right)\lim_{t\to\infty}V(\mathbf{s},t).
$$

На практике далеко не всегда удаётся достичь выхода $V(\mathbf{s},t)$ на постоянное значение --- глубина исследования ФП определяется доступным машинным временем, однако, стоит упомянуть, что в момент перехода системы в свободное плавание (@fig-meta-dynamics *в*) она начнёт быстро дрейфовать по поверхности свободной энергии и может даже совершить прыжок в область ФП вне интересующих нас пределов, об этом важно помнить, чтобы остановить моделирование в подходящий момент.

Резюмируем. Протокол метадинамики включает несколько шагов:
1. конструируются коллективные переменные $\mathbf{S}(\mathbf{q})$ --- функции координат атомов, цель которых --- ёмкое и исчерпывающее описание эволюции системы в процессе моделирования с позиции наблюдения интересующих исследователя событий, иными словами, изменение $\mathbf{S}(\mathbf{q})$ должно отражать протекание конкретного процесса, поскольку сэмплирование ФП происходит согласованно с пространством КП;
2. выбираются период наложения $\tau$, начальная высота $h_{0}$ и ширины $\sigma_{i}$ гауссиан;
3. проводится компьютерное моделирование со смещающим потенциалом $V(\mathbf{s},t)$;
4. восстанавливается вид поверхности свободной энергии по изменению $V(\mathbf{S},t)$ во времени.

[^footnote:CV-notation]: для удобства нотации полезно ввести следующий формализм: совокупность КП $\mathbf{S}=(S_1,\cdots,S_d)$ будем называть пространством КП, конкретное значение $S_i$ будем обозначать $s_i$, вектор в пространстве $\mathbf{S}$ запишем как $\mathbf{s}=(s_1,\cdots,s_d)$, выражение $\mathbf{S}(\mathbf{q})$ или $\mathbf{S}(t)\equiv\mathbf{S}(\mathbf{q}(t))$ подчёркивает, что КП зависят от координат или времени соответственно