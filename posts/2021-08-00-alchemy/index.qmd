---
title: Вычислительная алхимия
date: 2021-08
bibliography: ../../assets/citation.legacy.yaml
categories:
    - molecular dynamics
    - russian
---

В классическом молекулярном моделировании решается задача наиболее полного описания исследуемой системы: хорошая модель должна быть столь физична, сколь возможно этого добиться при имеющихся ограничениях (например, вычислительных ресурсах). 

::: {.column-margin}
Пост является продолжением [предыдущего](../2021-07-00-fep/index.qmd), где кратко были рассмотрены методы возмущения свободной энергии (FEP) и термодинамическое интегрирование (TI)
:::

Квантовой механикой можно достичь субатомного описания относительно небольших молекул; применение [крупнозернистых полей](../2021-03-00-force-fields/index.qmd#sec-coarse-grained) позволяет приближенно рассчитывать взаимодействия целых ансамблей макромолекул; насыщенные мицеллярные растворы, можно описывать уравнениями фазового состояния. В описанных ситуациях реальным физическим явлениям ставится в соответствие некоторый математический формализм, объясняющий их. Принципиально иной подход положен в основание методов *вычислительной алхимии*, суть которых заключается в моделировании нефизичного процесса превращения атомов одной природы в другие, при этом по крайней мере нарушается закон сохранения материи (массы). 

## Алхимический формализм одинарной и двойной топологии

От примера с оценкой энергии связывания фермента $\mathrm{E}$ и субстрата $\mathrm{L}$ мы перешли к интегрированию по пути $\lambda$ между двумя произвольными состояниями в фазовому пространству (ФП). По определению: точки ФП --- это $6N$-мерные векторы, состоящие из компонент импульсов $\mathbf{p}$ и координат $\mathbf{q}$ всех частиц в системе, ФП описывает состояние _физичной_ системы в смысле классической механики, однако мы можем обогатить ФП новыми степенями свободы, включив в него массу, заряд и другие свойства частиц. В расширенном ФП можно построить путь $\lambda$, соединяющий состояния $\mathcal{A}$ и $\mathcal{B}$, отвечающие разным химическим молекулам [@Chipot2007, с. 50].

На практике расчёт энергии перехода из одного состояния в другое проводится по формуле [термодинамического интегрирования](../2021-07-00-fep/index.qmd#sec-TI):

$$ \Delta F_{\mathcal{A}\mathcal{B}} = \int_0^1 \left\langle \frac{\partial U}{\partial \lambda} \right\rangle_\lambda \, \mathrm{d}\lambda, $$ {#eq-DF-by-avg-lambda-int}

однако этот расчёт можно реализовать по-разному. В дальнейших рассуждениях без ограничения общности будем считать, что алхимической трансформации $\mathcal A \to \mathcal B$ подвергается молекула лиганда. 

В молекулярной динамике (МД) потенциальная энергия $U(\mathbf{r}_1,\ldots,\mathbf{r}_N)$ [вычисляется](../2021-01-00-molecular-interactions/index.qmd) как сумма всех взаимодействий в системе:

$$
U = \underbrace{U_b + U_v + U_t + U_f}_{\text{ковалентные}} + \underbrace{U_q + U_d}_{\text{нековалентные}}.
$$ {#eq-md-U}

Путь алхимической трансформации $\lambda$, параметризующий превращение лиганда, может быть включён в выражение силового поля (СП), и тогда _топология_ (числовые параметры атомов СП и порядок их связей) трансформируемой молекулы плавно изменяется при движении в ФП, т.е. свойства атомов (масса $m$, заряд $q$ и др.) находятся в функциональной зависимости от пути $\lambda$:
$$
\begin{aligned}
q^i(\lambda) &= \lambda q^i_{\mathcal{A}} + (1-\lambda) q^i_{\mathcal{B}}, \\
&\;\;\vdots \\
m^i(\lambda) &= \lambda m^i_{\mathcal{A}} + (1-\lambda) m^i_{\mathcal{B}}.
\end{aligned}
$$

В другой реализации, расчёт проводится непосредственно по @eq-DF-by-avg-lambda-int, тогда в процессе трансформации молекула лиганда будет представлять собой суперпозицию начального $\mathcal A$ и конечного $\mathcal B$ состояний, каждая из которых будет описываться своей топологией. В этой постановке всё ФП или его область являются функцией от $\lambda$.

В обоих подходах в начале ($\lambda = 0$) и в конце ($\lambda = 1$) пути существую физичные молекулы, однако в формализме одинарной топологии в процессе трансформации параметры атомов, будь то заряд, масса или др., будут принимать промежуточные значения, т.е. не будут соответствовать ни одному настоящему атому. В формализме двойной топологии очевидно возникает проблема: потенциальная энергия молекулы в процессе трансформации согласно @eq-DF-by-avg-lambda-int описывается в виде взвешенной суммы. При попытке поместить две молекулы в одну область пространства неизбежно произойдёт расталкивание электронных облаков^[в МД аппроксимирующихся зарядами и потенциалами взаимодействия атомов], поэтому также необходимо указывать список атомов, общих для обеих структур, чтобы «исключить» их из взаимодействий между собой (и позволить занять одну область пространства), но оставить взаимодействие с окружением, масштабируя его согласно пути $\lambda$.

## Интегрирование по пути

Для проведения алхимической трансформации необходимо просемплировать ФП в разных точках алхимического пути $\lambda = 0..1$ и затем оценить значение интеграла по [формуле](../2021-07-00-fep/index.qmd#sec-TI):

$$
\Delta F_{\mathcal{A}\mathcal{B}} = \sum_{0 \le \lambda_k \le 1} \left\langle \frac{\partial U}{\partial \lambda} \right\rangle_{\lambda_k}.
$$ {#eq-DF-avg-lambda-sum}

Поскольку интегрирование проводится численно, узлы интегрирования (значения $\lambda$) могут выбираться из разных предпосылок. При интегрировании методом параллелограммов значения $\lambda$ могут браться с определённым шагом $\Delta \lambda$ или вовсе произвольно. Более продвинутые методы интегрирования могут накладывать ограничения на выбор $\lambda$; часто используемый метод Гаусса^[англ. Gaussian quadrature] уже предоставляет набор значений $\lambda$, который необходимо использовать в расчётах, итоговое значение интеграла вычисляется по простой формуле
$$
\int_a^b f(\lambda) \, \mathrm{d}\lambda \approx \sum_{i=1}^n w_i f(\lambda_i),
$$
где $w_i$ --- известные из метода Гаусса значения весов. Например, для числа узлов $n = 9$, значения $\lambda_i$ и $w_i$ приведены в @tbl-gauss-int. Значения $\lambda_i$ лежат симметрично относительно середины пути $\lambda = 0.5$; веса $w_i$ крайних точек в итоговом интеграле минимальны.

| $i$         | 1      | 2      | 3      | 4      | 5      | 6      | 7      | 8      | 9      |
| ----------- | ------ | ------ | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| $\lambda_i$ | 0.0159 | 0.082  | 0.1933 | 0.3379 | 0.5    | 0.6621 | 0.8067 | 0.918  | 0.9841 |
| $w_i$       | 0.0406 | 0.0903 | 0.1303 | 0.1562 | 0.1651 | 0.1562 | 0.1303 | 0.0903 | 0.0406 |
Table: Значения $\lambda_i$ и $w_i$ для интегрирования методом Гаусса {#tbl-gauss-int}

## Расчёт энергии связывания

Метод алхимической трансформации позволяет оценивать энергию превращения одной молекулы в другую путём изменения параметров атомов или преобразованиями функции внутринней энергии $U$. Получаемые в результате алхимии значения энергии $\Delta_\text{alc} F$ не могут быть проверены в эксперименте непосредственно, но могут использоваться для получения ТД параметров связывания. 

![Термодинамический цикл для расчёта разности энергии связывания $\Delta \Delta_b G$](td-cycle.svg){#fig-td-cycle width=60%}

Опишем ТД цикл (@fig-td-cycle) для определения разности энергий связывания $\Delta \Delta_b G$ пары лигандов $\text{A}$ и $\text{B}$, в активном центре фермента $\text{E}$. Для трансформаций лигандов $\text{A}$ $\to$ $\text{B}$ и комплексов $\text{EA}$ $\to$ $\text{EB}$ соответствующие значения алхимических энергий $\Delta_\text{alc} F_L$ и $\Delta_\text{alc} F_C$ могут быть рассчитаны, а значения энергий связывания $\Delta_b G_{\rm A}$ и $\Delta_b G_{\rm B}$ определены в эксперименте. Исходя из ТД цикла и с учётом знаков

$$
\Delta_{\mathrm{alc}} F_C = -\Delta_b G_{\mathrm{A}} + \Delta_{\mathrm{alc}} F_L + \Delta_b G_{\mathrm{B}},
$$
откуда
$$
\underbrace{\Delta_{\mathrm{alc}} F_C - \Delta_{\mathrm{alc}} F_L}_{\Delta_{\mathrm{calc}} \Delta_b F} = 
\underbrace{\Delta_b G_{\mathrm{B}} - \Delta_b G_{\mathrm{A}}}_{\Delta_{\mathrm{exp}} \Delta_b G},
$$
т.е. разница энергий связывания $\Delta \Delta_b G$ может быть определена экспериментально или рассчитана.

Моделирование белка (в данном случае в комплексе с лигандом) (@fig-td-cycle _б_) требует соответствующего размера ячейки, заполненной водой. Для корректного сопоставления энергии, размер систем (количество частиц^[уже нарушается в процессе алхимической трансформации]) при превращении лигандов должен соответствовать системе белка (комплексов), однако, при превращении свободных лигандов фермент должен быть удалён на бесконечное расстояние (@fig-td-cycle _а_), а поскольку нас интересует только разность энергий $\Delta_\text{alc} F_L$ (энергия алхимического превращения), из системы можно исключить фермент и всю необходимую его воду, имеющие одинаковый энергетический вклад до и после превращения; проще говоря, моделирование лигандов можно проводить в ячейке малого размера, что значительно экономит время расчёта.

::: {.column-margin}
Имея в распоряжении экспериментально измеренную энергию связывания с помощью метода алхимической трансформации можно рассчитать поправки и определить энергию связывания для целого набора химически близких лигандов, что делает описанный метод мощным инструментом для поиска ингибиторов и лекарственных молекул.
:::

Рассчитанные значения $\Delta \Delta F_b$ могут быть использованы как поправки: энергия связывания с лигандом $\text{B}$ может быть рассчитана через экспериментальное значение энергии связывания $\Delta_b F_A$ и вычисленную поправку --- энергию алхимической трансформации $\Delta \Delta_b F$:

$$
\Delta_b G_{\mathrm{B}} = \Delta_b G_{\mathrm{A}} + \Delta_{\mathrm{A} \to \mathrm{B}} \Delta_b F,
$$
последнее верно в силу того, что и $F$, и $G$ являются функциями состояния, более того, в конденсированных фазах $\Delta F \approx \Delta G$.